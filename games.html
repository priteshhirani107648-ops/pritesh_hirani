<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EDA Simulators | Pritesh Hirani</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ®</text></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* ================= COLOR PALETTE & MASTER RESETS ================= */
        :root {
            --bg-dark: #050810;
            --panel-bg: rgba(13, 19, 33, 0.85);
            --accent-1: #00e5ff; 
            --accent-2: #ff007f; 
            --accent-3: #ffb800; 
            --success: #00ff88;  
            --danger: #ff2a5f;   
            --text-main: #ffffff;
            --text-secondary: #94a3b8;
            --glass-border: rgba(0, 229, 255, 0.15);
            --card-bg: rgba(13, 19, 33, 0.6);
        }

        *, *::before, *::after { box-sizing: border-box; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--bg-dark); color: var(--text-main); 
            background-image: radial-gradient(circle at top right, #111a2d 0%, #050810 100%); 
            min-height: 100vh; 
            cursor: pointer; 
            overflow-x: hidden;
            overflow-y: auto;
            display: flex; flex-direction: column;
            touch-action: manipulation;
        }

        a, button, .btn, .option-card, .route-cell, .gui-macro, .eco-wire, .eco-buf, .eco-gate, .insp-btn, .cg-cell, .sk-btn, .si-net, .sim-card, .macro-library-item { cursor: pointer !important; }

        #network { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; pointer-events: none; opacity: 0.5; }
        .cursor-dot, .cursor-outline { pointer-events: none; z-index: 99999; position: fixed; }

        /* ================= MOBILE WARNING ALERT ================= */
        #mobile-warning {
            display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(5, 8, 16, 0.98); z-index: 100005; align-items: center; justify-content: center; padding: 20px;
        }
        .warning-box {
            background: #000; border: 1px solid var(--danger); padding: 30px; border-radius: 12px;
            max-width: 400px; text-align: center; box-shadow: 0 0 30px rgba(255, 42, 95, 0.3); font-family: 'Space Mono', monospace;
        }
        .warning-box i { font-size: 3rem; color: var(--danger); margin-bottom: 20px; animation: pulse 1s infinite alternate; }
        .warning-box h2 { color: #fff; margin-bottom: 15px; font-size: 1.3rem; }
        .warning-box p { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 25px; }

        /* ================= LOADING SCREEN ================= */
        #loader-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--bg-dark); z-index: 100000; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.6s ease, visibility 0.6s ease;
            background-image: radial-gradient(circle at center, #111a2d 0%, #050810 100%);
        }
        #loader-overlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .loader-content { text-align: center; font-family: 'Space Mono', monospace; }
        .loader-icon { font-size: 3.5rem; color: var(--accent-1); margin-bottom: 25px; animation: pulse 1.2s infinite alternate; }
        .loader-text { color: #fff; font-size: 1.3rem; margin-bottom: 20px; letter-spacing: 2px; }
        .loader-bar { width: 250px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; margin: 0 auto 25px; }
        .loader-fill { width: 0%; height: 100%; background: var(--accent-1); box-shadow: 0 0 10px var(--accent-1); animation: loadFill 1.5s ease forwards; }
        .loader-credits { color: var(--text-secondary); font-size: 0.85rem; line-height: 1.8; }
        .loader-credits span { color: var(--accent-3); font-weight: bold; }
        
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; text-shadow: none; } 100% { transform: scale(1.1); opacity: 1; text-shadow: 0 0 25px currentColor; } }
        @keyframes loadFill { 0% { width: 0%; } 100% { width: 100%; } }

        /* ================= NAVBAR ================= */
        #navbar { 
            padding: 10px 5%; background: rgba(5, 8, 16, 0.95); border-bottom: 1px solid var(--glass-border); 
            display: flex; justify-content: space-between; align-items: center; 
            position: sticky; top: 0; left: 0; width: 100%; z-index: 1000; backdrop-filter: blur(12px); box-shadow: 0 4px 30px rgba(0,0,0,0.5); 
        }
        body.game-active #navbar { display: none !important; } 
        body.game-active #app-footer { display: none !important; } 
        
        .logo-link { text-decoration: none; color: white; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; font-family: 'Space Mono', monospace; }
        .back-link { color: var(--text-secondary); text-decoration: none; font-size: 0.9rem; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .back-link:hover { color: var(--accent-1); }

        /* ================= APP CORE ================= */
        #app-core { width: 100%; flex: 1; position: relative; z-index: 2; padding: 30px 5% 50px; display: flex; flex-direction: column; max-width: 1400px; margin: 0 auto; }
        body.game-active #app-core { padding: 15px 2%; height: 100vh; height: 100dvh; max-width: 100%; }

        /* ================= SYSTEM STATUS HUD (MENU) ================= */
        #menu-view { display: flex; flex-direction: column; width: 100%; }
        
        .hud-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px; padding: 15px 25px; margin-bottom: 30px; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .hud-title { font-family: 'Space Mono', monospace; font-size: 1.6rem; color: #fff; margin: 0; display: flex; align-items: center; gap: 10px; letter-spacing: -0.5px; }
        .hud-title i { color: var(--accent-1); font-size: 1.8rem; }
        
        .hud-stats { display: flex; gap: 20px; font-family: 'Space Mono', monospace; font-size: 0.85rem; color: var(--text-secondary); }
        .hud-stat-box { display: flex; flex-direction: column; align-items: flex-end; }
        .hud-stat-box span:first-child { font-size: 0.7rem; text-transform: uppercase; color: #555; }
        .hud-stat-box span:last-child { color: var(--success); font-weight: bold; }

        /* ================= HIGH-DENSITY GAME GRID ================= */
        .sim-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; width: 100%; }
        .sim-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 10px; padding: 25px 20px; text-decoration: none; display: flex; flex-direction: column; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 10px 30px rgba(0,0,0,0.4); backdrop-filter: blur(10px); position: relative; overflow: hidden; text-align: left; }
        .sim-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.8); background: rgba(13, 19, 33, 0.9); }
        
        .sim-card.c1 { border-top: 3px solid var(--accent-1); }
        .sim-card.c2 { border-top: 3px solid var(--accent-2); }
        .sim-card.c3 { border-top: 3px solid var(--success); }
        .sim-card.c4 { border-top: 3px solid var(--accent-3); }
        .sim-card.c5 { border-top: 3px solid var(--danger); }
        .sim-card.c6 { border-top: 3px solid #a29bfe; }
        .sim-card.c7 { border-top: 3px solid #00cec9; }

        .sim-card:hover.c1 { border-color: var(--accent-1); box-shadow: 0 15px 30px rgba(0, 229, 255, 0.15); }
        .sim-card:hover.c2 { border-color: var(--accent-2); box-shadow: 0 15px 30px rgba(255, 0, 127, 0.15); }
        .sim-card:hover.c3 { border-color: var(--success); box-shadow: 0 15px 30px rgba(0, 255, 136, 0.15); }
        .sim-card:hover.c4 { border-color: var(--accent-3); box-shadow: 0 15px 30px rgba(255, 184, 0, 0.15); }
        .sim-card:hover.c5 { border-color: var(--danger); box-shadow: 0 15px 30px rgba(255, 42, 95, 0.15); }
        .sim-card:hover.c6 { border-color: #a29bfe; box-shadow: 0 15px 30px rgba(162, 155, 254, 0.15); }
        .sim-card:hover.c7 { border-color: #00cec9; box-shadow: 0 15px 30px rgba(0, 206, 201, 0.15); }

        .sim-icon { font-size: 1.8rem; margin-bottom: 12px; display: inline-flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 8px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; pointer-events: none; }
        .sim-card.c1 .sim-icon { color: var(--accent-1); }
        .sim-card.c2 .sim-icon { color: var(--accent-2); }
        .sim-card.c3 .sim-icon { color: var(--success); }
        .sim-card.c4 .sim-icon { color: var(--accent-3); }
        .sim-card.c5 .sim-icon { color: var(--danger); }
        .sim-card.c6 .sim-icon { color: #a29bfe; }
        .sim-card.c7 .sim-icon { color: #00cec9; }
        .sim-card:hover .sim-icon { transform: scale(1.1) rotate(5deg); background: rgba(255,255,255,0.1); }
        .sim-title { font-family: 'Space Mono', monospace; font-size: 1.3rem; color: #fff; margin: 0 0 8px; pointer-events: none; }
        .sim-desc { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; margin: 0 0 20px; flex-grow: 1; pointer-events: none; }
        .sim-btn { font-family: 'Space Mono', monospace; font-size: 0.85rem; font-weight: bold; text-transform: uppercase; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); transition: 0.3s; pointer-events: none; }
        .sim-card:hover .sim-btn { color: #fff; gap: 12px; }

        /* ================= GAME MODULE CONTAINER ================= */
        .module-container { display: none; width: 100%; max-width: 1000px; margin: 0 auto; padding: 0; flex: 1; min-height: 0; }
        .module-container.active-mod { display: flex; flex-direction: column; justify-content: center; animation: fadeIn 0.4s ease forwards; }
        @keyframes fadeIn { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        
        .quiz-hud { background: var(--panel-bg); border: 1px solid rgba(255,255,255,0.1); border-top: 2px solid var(--accent-1); border-radius: 24px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8); }
        .hud-top { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); padding-bottom: 20px; margin-bottom: 25px; }
        .hud-title { font-family: 'Space Mono', monospace; font-size: 1.6rem; font-weight: bold; color: var(--text-main); display: flex; align-items: center; gap: 12px; }
        .stop-btn { background: rgba(255, 42, 95, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 10px 20px; border-radius: 8px; font-family: 'Space Mono', monospace; font-size: 1rem; font-weight: bold; transition: 0.3s; display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .stop-btn:hover { background: var(--danger); color: #fff; box-shadow: 0 0 20px var(--danger); }
        .game-desc { color: var(--text-secondary); font-size: 1.1rem; text-align: center; margin-bottom: 25px; line-height: 1.5; background: rgba(0,0,0,0.4); padding: 15px; border-radius: 12px; border: 1px dashed rgba(255,255,255,0.1); }
        .quiz-action-btns { display: flex; justify-content: center; gap: 20px; margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 25px; }
        .quiz-action-btns .btn { width: auto; min-width: 200px; padding: 15px 30px; font-size: 1.2rem; cursor: pointer; background: rgba(0, 229, 255, 0.1); border: 1px solid var(--accent-1); color: var(--accent-1); border-radius: 12px; font-family: 'Space Mono', monospace; font-weight: bold; transition: 0.3s; text-transform: uppercase;}
        .quiz-action-btns .btn:hover { background: var(--accent-1); color: #000; box-shadow: 0 0 20px var(--accent-1); }

        .workspace-flex { display: flex; flex-direction: column; gap: 30px; align-items: center; width: 100%; position: relative; }

        /* ================= 1. QUIZ STYLES ================= */
        .quiz-meta-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; width: 100%; }
        .quiz-timer-container { position: relative; width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; margin: 0 auto; }
        .timer-circle-bg { fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 4; }
        .timer-circle-prog { fill: none; stroke: var(--accent-1); stroke-width: 4; stroke-dasharray: 163; stroke-dashoffset: 0; transition: 1s linear; transform: rotate(-90deg); transform-origin: 50% 50%; filter: drop-shadow(0 0 5px var(--accent-1)); }
        .timer-text { position: absolute; font-family: 'Space Mono', monospace; font-size: 1.6rem; font-weight: bold; color: var(--text-main); }
        #question-text { font-size: 1.5rem; line-height: 1.6; text-align: center; margin-bottom: 30px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; }
        .option-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 25px 20px; border-radius: 16px; transition: 0.3s; font-size: 1.2rem; color: var(--text-secondary); display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .option-card::before { content: '\f111'; font-family: 'Font Awesome 6 Free'; font-weight: 400; font-size: 1.2rem; color: var(--text-secondary); opacity: 0.5; }
        .option-card:hover { border-color: var(--accent-1); color: #fff; transform: translateY(-3px); background: rgba(0,229,255,0.05); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .option-card.correct { background: rgba(0,255,136,0.1) !important; border-color: var(--success) !important; color: var(--success) !important; box-shadow: 0 0 20px rgba(0,255,136,0.2); pointer-events: none; }
        .option-card.correct::before { content: '\f058'; font-weight: 900; color: var(--success); opacity: 1; }
        .option-card.wrong { background: rgba(255,42,95,0.1) !important; border-color: var(--danger) !important; color: var(--danger) !important; box-shadow: 0 0 20px rgba(255,42,95,0.2); pointer-events: none; }
        .option-card.wrong::before { content: '\f057'; font-weight: 900; color: var(--danger); opacity: 1; }

        /* ================= 2. FLOORPLAN STYLES ================= */
        #fp-split { display: flex; flex-direction: row; gap: 40px; justify-content: center; align-items: flex-start; width: 100%; }
        #chip-core { width: 450px; height: 450px; border: 2px dashed var(--accent-1); background: rgba(0,0,0,0.6); position: relative; border-radius: 12px; box-shadow: inset 0 0 30px rgba(0,0,0,0.8); overflow: hidden; touch-action: none; }
        #chip-core-bg { position: absolute; top:0; left:0; width:100%; height:100%; background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px); background-size: 20px 20px; pointer-events: none; }
        #macro-side-panel { width: 220px; min-height: 450px; background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; gap: 15px; align-items: center; }
        
        .macro-library-item { background: rgba(255, 0, 127, 0.1); border: 1px solid var(--accent-2); width: 60px; height: 40px; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #fff; font-family: 'Space Mono', monospace; font-size: 0.8rem; font-weight: bold; cursor: grab; transition: 0.2s; box-shadow: 0 0 10px rgba(255, 0, 127, 0.2); touch-action: none; user-select: none; }
        .macro-library-item:hover { background: rgba(255, 0, 127, 0.3); transform: scale(1.05); }

        .gui-macro { position: absolute; background: rgba(255, 0, 127, 0.4); border: 2px solid var(--accent-2); display: flex; align-items: center; justify-content: center; color: #fff; font-family: 'Space Mono'; font-weight: bold; touch-action: none; user-select: none; box-shadow: 0 0 15px rgba(255, 0, 127, 0.3); z-index: 10; cursor: grab; }
        .gui-macro.dragging { z-index: 100; opacity: 0.8; border-color: #fff; transform: scale(1.05); cursor: grabbing; }
        .gui-macro.overlap { background: rgba(255, 42, 95, 0.7) !important; border-color: var(--danger) !important; animation: shake 0.2s infinite; box-shadow: 0 0 20px var(--danger) !important; z-index: 101; }
        .gui-macro.fixed { background: rgba(0, 229, 255, 0.15); border-color: var(--accent-1); color: var(--accent-1); box-shadow: inset 0 0 20px rgba(0, 229, 255, 0.3); }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-4px);} 75% {transform: translateX(4px);} }

        /* ================= 3 & 5. SHARED ROUTING GRID STYLES ================= */
        .routing-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; background: rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 16px; width: 450px; height: 450px; margin: 0 auto; box-shadow: inset 0 0 40px rgba(0,0,0,0.8); }
        .route-cell { border-radius: 8px; display: flex; align-items: center; justify-content: center; font-family: 'Space Mono'; font-size: 1.5rem; font-weight: bold; color: white; transition: 0.2s; overflow: hidden; position: relative; cursor: pointer; }
        .rt-empty { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); }
        .rt-empty:hover { border-color: var(--accent-1); background: rgba(0,229,255,0.15); transform: scale(1.05); z-index: 2; box-shadow: 0 0 20px rgba(0,229,255,0.3); }
        .rt-start { background: var(--accent-3); color: #000; box-shadow: 0 0 20px var(--accent-3); border: 2px solid #fff; z-index: 3; }
        .rt-end { background: var(--success); color: #000; box-shadow: 0 0 20px var(--success); border: 2px solid #fff; z-index: 3; }
        .rt-obs { background: repeating-linear-gradient(45deg, rgba(255,42,95,0.2), rgba(255,42,95,0.2) 8px, rgba(0,0,0,0.6) 8px, rgba(0,0,0,0.6) 16px); border: 1px solid rgba(255,42,95,0.5); pointer-events: none; }
        .rt-path { background: var(--accent-1); color: #000; box-shadow: 0 0 20px var(--accent-1); border: 1px solid #fff; }
        .rt-head { transform: scale(1.15); z-index: 5; border: 3px solid #fff; box-shadow: 0 0 30px var(--accent-1); }

        /* ================= 4. TIMING ECO STYLES ================= */
        .stat-bar { display: flex; gap: 15px; flex-wrap: wrap; width: 100%; margin-bottom: 20px; justify-content: center; }
        .stat-box { background: rgba(0,0,0,0.5); padding: 12px 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); flex: 1; text-align: center; font-family: 'Space Mono'; font-size: 1rem; min-width: 120px; transition: 0.3s; display: flex; flex-direction: column; gap: 5px; }
        .stat-val { font-size: 1.6rem; font-weight: bold; color: #fff; transition: 0.3s; }
        .alert-txt { border-color: var(--danger) !important; box-shadow: inset 0 0 20px rgba(255,42,95,0.3); }
        .alert-txt .stat-val { color: var(--danger); text-shadow: 0 0 15px var(--danger); animation: pulseText 1.5s infinite; }
        
        .eco-canvas { width: 100%; display: flex; align-items: center; justify-content: flex-start; padding-left: 20px; overflow-x: auto; background: rgba(0,0,0,0.5); border-radius: 16px; border: 1px inset rgba(255,255,255,0.05); padding-top: 30px; padding-bottom: 30px; gap: 15px; box-shadow: inset 0 0 40px rgba(0,0,0,0.6); }
        .eco-flop { background: rgba(255,255,255,0.05); border: 2px solid var(--text-secondary); padding: 25px 20px; border-radius: 12px; font-family: 'Space Mono'; font-size: 1.2rem; font-weight: bold; flex-shrink: 0; text-align: center; color: var(--text-secondary); }
        .eco-wire-wrap { display: flex; align-items: center; position: relative; flex-shrink: 0; }
        .eco-wire { width: 60px; height: 12px; background: rgba(0,229,255,0.3); border-radius: 6px; display: flex; justify-content: space-evenly; align-items: center; transition: 0.2s; border: 1px solid rgba(0,229,255,0.2); cursor: pointer; }
        .eco-wire:hover { background: rgba(0,229,255,0.6); border-color: var(--accent-1); box-shadow: 0 0 20px var(--accent-1); transform: scaleY(1.4); }
        .eco-buf { width: 24px; height: 24px; background: var(--accent-2); border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 15px var(--accent-2); z-index: 5; transition: 0.2s; cursor: pointer; }
        .eco-buf:hover { transform: scale(1.3); }
        
        .eco-gate { background: var(--panel-bg); border: 2px solid var(--accent-1); padding: 20px 15px; border-radius: 12px; text-align: center; flex-shrink: 0; width: 120px; transition: 0.3s; font-family: 'Space Mono'; position: relative; z-index: 10; box-shadow: 0 10px 20px rgba(0,0,0,0.6); cursor: pointer; }
        .eco-gate:hover { border-color: #fff; transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,229,255,0.4); }
        .eco-gate.active { background: rgba(0,229,255,0.2); border-color: #fff; box-shadow: 0 0 30px var(--accent-1); transform: translateY(-5px) scale(1.05); }
        .gate-nm { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; color: #fff; pointer-events: none; }
        .gate-sp { font-size: 0.9rem; color: var(--accent-1); display: flex; flex-direction: column; gap: 3px; pointer-events: none; }

        .inspector { background: rgba(0,0,0,0.6); border: 1px solid var(--glass-border); padding: 20px 30px; border-radius: 16px; margin-top: 20px; display: none; box-shadow: inset 0 0 30px rgba(0,0,0,0.6); width: 100%; max-width: 800px; margin-inline: auto; }
        .inspector.visible { display: block; animation: fadeIn 0.3s ease; }
        .insp-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 20px; }
        .insp-label { font-family: 'Space Mono'; color: var(--text-secondary); font-size: 1.1rem; width: 80px; }
        .insp-btn-group { display: flex; gap: 10px; flex: 1; }
        .insp-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 12px 20px; border-radius: 8px; font-family: 'Space Mono'; font-size: 1rem; transition: 0.2s; flex: 1; text-align: center; cursor: pointer; }
        .insp-btn:hover { background: rgba(255,255,255,0.15); border-color: #fff; }
        .insp-btn.active { background: var(--accent-1); border-color: #fff; color: #000; font-weight: bold; box-shadow: 0 0 20px var(--accent-1); }

        /* ================= 5. CONGESTION STYLES ================= */
        .cg-cell { border: 1px solid rgba(255,255,255,0.05); position: relative; }
        .cg-empty { background: rgba(15, 23, 42, 0.4); }
        .cg-safe { background: rgba(0, 229, 255, 0.15); border-color: rgba(0, 229, 255, 0.3); }
        .cg-warn { background: rgba(241, 196, 15, 0.25); border-color: rgba(241, 196, 15, 0.5); }
        .cg-full { background: rgba(255, 127, 0, 0.4); border-color: #ff7f00; }
        .cg-drc { background: rgba(255, 42, 95, 0.5); border-color: var(--danger); box-shadow: inset 0 0 30px var(--danger); animation: pulseRed 1s infinite; pointer-events: none; }
        
        .cg-wire-dot { position: absolute; width: 18px; height: 18px; background: #fff; border-radius: 50%; box-shadow: 0 0 20px #fff; z-index: 2; pointer-events: none; }
        .cg-st { position: absolute; top: 8px; left: 10px; font-family: 'Space Mono'; font-size: 1.5rem; font-weight: bold; text-shadow: 0 0 10px #000, 2px 2px 0 #000; z-index: 3; color: var(--success); pointer-events: none; }
        .cg-st.target { color: var(--accent-1); }
        .cg-label { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Space Mono'; font-size: 1.6rem; font-weight: bold; color: #fff; text-shadow: 0 0 10px #000, 0 0 20px #000; z-index: 3; pointer-events: none; }

        /* ================= 6. CROSSTALK (DRAG & DROP) STYLES ================= */
        .si-workspace { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 800px; margin: 0 auto; position: relative; }
        .si-track { position: relative; width: 100%; height: 80px; background: rgba(0,0,0,0.5); border-radius: 16px; background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 100% 15px; border: 1px dashed rgba(255,255,255,0.1); transition: 0.3s; }
        
        .si-net { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--panel-bg); border: 1px solid rgba(255,255,255,0.2); border-radius: 16px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; transition: transform 0.1s, box-shadow 0.1s, border-color 0.2s; touch-action: none; z-index: 2; box-shadow: 0 5px 20px rgba(0,0,0,0.4); cursor: grab; }
        .si-net:hover { border-color: rgba(255,255,255,0.5); }
        .si-net:active { cursor: grabbing; }
        .si-net.dragging { opacity: 0.95; transform: scale(1.05); box-shadow: 0 25px 50px rgba(0,0,0,0.8), 0 0 30px var(--accent-1); z-index: 100; border-color: var(--accent-1); background: rgba(13, 19, 33, 0.95); }
        
        .si-info { display: flex; align-items: center; gap: 20px; flex-grow: 1; pointer-events: none; }
        .si-grip { color: var(--text-secondary); font-size: 1.8rem; pointer-events: none; opacity: 0.5; }
        .si-icon { font-size: 2.2rem; width: 40px; text-align: center; pointer-events: none; filter: drop-shadow(0 0 10px currentColor); }
        .si-text { display: flex; flex-direction: column; pointer-events: none; }
        .si-name { font-weight: bold; font-size: 1.3rem; letter-spacing: 0.5px; }
        .si-emit { font-size: 0.9rem; color: var(--text-secondary); font-family: 'Space Mono'; }
        
        .si-badge-wrap { display: flex; flex-direction: column; align-items: flex-end; pointer-events: none; }
        .si-badge-lbl { font-size: 0.8rem; color: var(--text-secondary); font-family: 'Space Mono'; margin-bottom: 4px; text-transform: uppercase; }
        .si-badge { font-family: 'Space Mono'; font-weight: bold; font-size: 1.4rem; padding: 8px 20px; border-radius: 8px; border: 1px solid; background: rgba(0,0,0,0.8); transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.6); }

        /* ================= 7. USEFUL SKEW STYLES ================= */
        .skew-pipe { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 600px; margin: 0 auto; background: rgba(0,0,0,0.5); padding: 30px 20px; border-radius: 20px; border: 1px solid var(--glass-border); box-shadow: inset 0 0 40px rgba(0,0,0,0.7); flex-grow: 1; min-height: 0; justify-content: flex-start; overflow-y: auto; gap: 15px; }
        .skew-flop-box { width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; flex-shrink: 0; }
        .skew-flop { background: var(--panel-bg); border: 2px solid rgba(255,255,255,0.3); padding: 20px; border-radius: 16px; width: 240px; text-align: center; z-index: 2; box-shadow: 0 15px 30px rgba(0,0,0,0.6); transition: 0.3s; }
        .skew-flop.active { border-color: var(--accent-1); box-shadow: 0 0 30px rgba(0, 229, 255, 0.3); background: rgba(0, 229, 255, 0.05); }
        .sk-title { font-family: 'Space Mono'; font-weight: bold; color: #fff; font-size: 1.3rem; border-bottom: 1px dashed rgba(255,255,255,0.2); padding-bottom: 8px; margin-bottom: 10px; }
        .sk-val { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 15px; }
        .sk-btns { display: flex; justify-content: center; gap: 20px; }
        .sk-btn { background: rgba(255,255,255,0.05); border: 2px solid #fff; color: #fff; width: 45px; height: 45px; border-radius: 50%; font-weight: bold; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; cursor: pointer; }
        .sk-btn:hover { background: var(--accent-1); border-color: var(--accent-1); color: #000; transform: scale(1.1); box-shadow: 0 0 20px var(--accent-1); }
        .skew-path-box { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 40px; margin: 10px 0; position: relative; flex-shrink: 0; }
        .skew-path-box::before { content: ''; position: absolute; left: 50%; top: -25px; bottom: -25px; width: 6px; background: rgba(255,255,255,0.1); transform: translateX(-50%); z-index: 1; border-radius: 3px; }
        .sk-logic, .sk-slack { background: rgba(0,0,0,0.9); border: 1px solid rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; font-family: 'Space Mono'; text-align: center; width: 140px; z-index: 2; color: #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.6); font-size: 0.9rem; }
        .sk-logic span { font-size: 1.4rem; font-weight: bold; color: var(--accent-1); display: block; margin-top: 5px; }
        .sk-slack { border-width: 2px; }
        .sk-slack span { font-size: 1.5rem; font-weight: bold; display: block; margin-top: 5px; }
        .sk-slack.good { border-color: var(--success); }
        .sk-slack.good span { color: var(--success); text-shadow: 0 0 15px rgba(0,255,136,0.5); }
        .sk-slack.bad { border-color: var(--danger); animation: pulseRed 1s infinite; box-shadow: 0 0 30px rgba(255,42,95,0.4); }
        .sk-slack.bad span { color: var(--danger); text-shadow: 0 0 15px rgba(255,42,95,0.5); }

        /* ================= MODALS ================= */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(5, 8, 16, 0.95); backdrop-filter: blur(15px); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: 0.4s; padding: 20px; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-box { background: var(--panel-bg); border: 2px solid var(--accent-1); width: 100%; max-width: 450px; padding: 40px 30px; text-align: center; border-radius: 20px; transform: scale(0.9) translateY(20px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 25px 60px rgba(0,0,0,0.8), inset 0 0 30px rgba(0, 229, 255, 0.1); }
        .modal-overlay.active .modal-box { transform: scale(1) translateY(0); }
        .mod-icon { font-size: 5rem; margin-bottom: 20px; }
        .mod-title { font-family: 'Space Mono', monospace; font-size: 1.8rem; margin: 0 0 20px; letter-spacing: -0.5px; }
        .mod-stats { display: flex; justify-content: center; gap: 30px; background: rgba(0,0,0,0.6); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.05); }
        .mod-stat { display: flex; flex-direction: column; font-family: 'Space Mono'; gap: 5px; }
        .mod-stat span:first-child { font-size: 0.85rem; color: var(--text-secondary); }
        .mod-stat span:last-child { font-size: 1.6rem; font-weight: bold; }
        .mod-msg { color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 30px; line-height: 1.6; }
        .mod-btns { display: flex; flex-direction: column; gap: 15px; }

        /* ================= FOOTER ================= */
        .app-footer { background: rgba(5, 8, 16, 0.95); border-top: 1px solid var(--glass-border); padding: 15px 5%; text-align: center; font-family: 'Space Mono', monospace; font-size: 0.85rem; color: var(--text-secondary); z-index: 1000; flex-shrink: 0; line-height: 1.6; }
        .app-footer span { color: var(--accent-1); font-weight: bold; }

        /* ================= MOBILE RESPONSIVENESS ================= */
        @media (max-width: 850px) {
            #app-core { padding: 15px 5% 30px; }
            .hud-header { flex-direction: column; align-items: center; text-align: center; padding: 15px; margin-bottom: 20px; }
            .hud-stats { justify-content: center; width: 100%; }
            body.game-active #app-core { padding: 10px; }
            .module-container { padding: 0 !important; margin: 0 !important; }
            .quiz-hud { padding: 15px 10px; border-radius: 16px; }
            .hud-top { padding-bottom: 10px; margin-bottom: 10px; }
            .hud-title { font-size: 1.1rem; }
            .stop-btn { padding: 6px 12px; font-size: 0.75rem; }
            .game-desc { font-size: 0.8rem; padding: 8px; margin-bottom: 10px; }
            .quiz-action-btns { margin-top: auto; padding-top: 10px; flex-direction: row; }
            .quiz-action-btns .btn { padding: 12px; font-size: 0.85rem; min-width: 0; flex: 1; }
            .options-grid { grid-template-columns: 1fr; }
            
            /* Floorplan Mobile */
            #fp-split { flex-direction: column; align-items: center; gap: 10px; }
            #chip-core { width: min(100%, 45vh); height: min(100%, 45vh); max-height: 350px; max-width: 350px; }
            #macro-side-panel { width: 100%; max-width: 350px; flex-direction: row; height: auto; min-height: 60px; max-height: 120px; padding: 10px; flex-wrap: wrap; }
            .macro-library-item { font-size: 0.75rem; padding: 5px 10px; width: auto; height: auto; }
            
            /* Router Mobile */
            .routing-grid { width: min(100%, 50vh); height: min(100%, 50vh); max-height: 350px; max-width: 350px; padding: 8px; gap: 3px; }
            .route-cell { font-size: 1rem; }
            .cg-st { font-size: 1.1rem; top: 4px; left: 6px; }
            .cg-label { font-size: 1.1rem; }
            
            /* ECO Mobile */
            .stat-box { font-size: 0.75rem; min-width: 45%; padding: 8px 5px; }
            .stat-val { font-size: 1.1rem; }
            .eco-canvas { padding: 15px 10px; min-height: 120px; justify-content: flex-start; }
            .eco-flop { font-size: 0.8rem; padding: 12px 8px; }
            .eco-gate { width: 70px; padding: 8px 4px; }
            .eco-wire { width: 25px; }
            .eco-buf { width: 16px; height: 16px; }
            .inspector { padding: 10px; margin-top: 5px; flex-shrink: 0; }
            .insp-btn { padding: 8px 10px; font-size: 0.75rem; flex: 1; text-align: center; }
            
            /* Crosstalk Mobile */
            .si-track { min-height: 50px; }
            .si-net { padding: 0 12px; }
            .si-name { font-size: 0.8rem; }
            .si-icon { font-size: 1.3rem; width: 25px; }
            .si-badge { font-size: 0.9rem; padding: 4px 8px; }
            .si-badge-lbl { display: none; }
            
            /* Skew Mobile */
            .skew-pipe { padding: 15px 10px; gap: 8px; }
            .skew-flop { width: 140px; padding: 10px; }
            .sk-title { font-size: 0.9rem; margin-bottom: 4px; }
            .sk-val { font-size: 0.8rem; margin-bottom: 8px; }
            .skew-path-box { padding: 0 15px; margin: 8px 0; }
            .sk-logic, .sk-slack { width: 95px; padding: 8px; font-size: 0.7rem; }
            .sk-logic span, .sk-slack span { font-size: 1rem; }
            .sk-btn { width: 35px; height: 35px; font-size: 1.2rem; }
        }

        @media (max-width: 380px) {
            #chip-core { max-width: 270px; max-height: 270px; }
            .routing-grid { max-width: 280px; max-height: 280px; }
            .cg-label { font-size: 0.9rem; }
        }
    </style>
</head>
<body>

<div id="mobile-warning">
    <div class="warning-box">
        <i class="fa-solid fa-laptop-code"></i>
        <h2>SYSTEM COMPATIBILITY ERROR</h2>
        <p>Simulation physics and high-precision EDA tools are optimized for desktop environments. Some games may not function properly on mobile devices.</p>
        <button class="btn" style="background: rgba(255,42,95,0.2); color: #fff; border-color: var(--danger);" onclick="closeWarning()">PROCEED ANYWAY</button>
        <p style="margin-top: 15px; font-size: 0.7rem; color: var(--accent-3);">RECOMMENDED: OPEN ON LAPTOP/PC</p>
    </div>
</div>

<div class="cursor-dot"></div>
<div class="cursor-outline"></div>
<canvas id="network"></canvas>

<div id="loader-overlay">
    <div class="loader-content">
        <i class="fa-solid fa-gamepad loader-icon"></i>
        <div class="loader-text">Loading Simulators...</div>
        <div class="loader-bar"><div class="loader-fill"></div></div>
        <div class="loader-credits">Developed by <span>Pritesh Hirani</span><br>Powered by <span>Hirani Tech</span></div>
    </div>
</div>

<nav id="navbar">
    <a href="index.html" class="logo-link"><i class="fa-solid fa-microchip" style="color: var(--accent-1);"></i> Pritesh_Hirani</a>
    <a href="index.html" class="back-link"><i class="fa-solid fa-arrow-left"></i> <span>Command Center</span></a>
</nav>

<div id="app-core">
    
    <div id="menu-view">
        <div class="hud-header">
            <h1 class="hud-title"><i class="fa-solid fa-gamepad"></i> EDA_Simulators</h1>
            <div class="hud-stats">
                <div class="hud-stat-box">
                    <span>Active Modules</span>
                    <span>7 ONLINE</span>
                </div>
            </div>
        </div>

        <div class="sim-grid" id="main-menu">
            <div class="sim-card c1" onclick="initQuiz()"><div class="sim-icon"><i class="fa-solid fa-brain"></i></div><h2 class="sim-title">Logic Quiz</h2><p class="sim-desc">30s pressure test for VLSI concepts.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
            <div class="sim-card c2" onclick="initFloorplan()"><div class="sim-icon"><i class="fa-solid fa-layer-group"></i></div><h2 class="sim-title">Floorplan</h2><p class="sim-desc">DRC-clean dynamic macro placement.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
            <div class="sim-card c3" onclick="initRouter()"><div class="sim-icon"><i class="fa-solid fa-network-wired"></i></div><h2 class="sim-title">Nano Router</h2><p class="sim-desc">Avoid obstacles to route critical nets.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
            <div class="sim-card c4" onclick="initECO()"><div class="sim-icon"><i class="fa-solid fa-stopwatch"></i></div><h2 class="sim-title">Timing ECO</h2><p class="sim-desc">Fix Setup/Hold violations with VT & Size.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
            <div class="sim-card c5" onclick="initCongestion()"><div class="sim-icon"><i class="fa-solid fa-map-location-dot"></i></div><h2 class="sim-title">Congestion</h2><p class="sim-desc">Detour nets around dynamic GCell hotspots.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
            <div class="sim-card c6" onclick="initSI()"><div class="sim-icon"><i class="fa-solid fa-satellite-dish"></i></div><h2 class="sim-title">Crosstalk</h2><p class="sim-desc">Drag & drop tracks to shield Victim nets.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
            <div class="sim-card c7" onclick="initSkew()"><div class="sim-icon"><i class="fa-solid fa-clock-rotate-left"></i></div><h2 class="sim-title">Useful Skew</h2><p class="sim-desc">Borrow time to fix critical datapaths.</p><div class="sim-btn">Initialize <i class="fa-solid fa-arrow-right"></i></div></div>
        </div>
    </div>

    <section id="quiz-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-brain"></i> LOGIC_ASSESSMENT</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <div class="quiz-meta-row">
                <div class="quiz-timer-container">
                    <svg class="timer-svg" viewBox="0 0 60 60"><circle class="timer-circle-bg" cx="30" cy="30" r="26"></circle><circle class="timer-circle-prog" id="timer-bar" cx="30" cy="30" r="26"></circle></svg>
                    <div class="timer-text" id="timer-val">30</div>
                </div>
                <div style="font-family: 'Space Mono'; color: var(--accent-1); font-weight: bold; background: rgba(0,229,255,0.1); padding: 8px 15px; border-radius: 8px; border: 1px solid rgba(0,229,255,0.2);" id="quiz-progress">Node: 1/4</div>
            </div>
            <h2 id="question-text"></h2>
            <div id="options-grid" class="options-grid"></div>
            <div class="quiz-action-btns"><button id="finish-early" class="btn" style="background: rgba(255, 42, 95, 0.1); border-color: var(--danger); color: var(--danger);" onclick="finishQuizEarly()">Submit Early</button><button id="next-q" class="btn" style="display:none;" onclick="nextQuestion()">Continue <i class="fa-solid fa-chevron-right"></i></button></div>
        </div>
    </section>

    <section id="floorplan-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-layer-group"></i> MACRO_PLACEMENT</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <div class="stat-bar"><div class="stat-box" id="hud-drc-fp" style="border-color: var(--danger); color: var(--danger);">DRC VIOLATIONS<br><span class="stat-val" id="ov-count" style="color:var(--danger);">0</span></div></div>
            <p class="game-desc">Drag logic macros into the core. 0 Overlaps allowed.</p>
            <div class="workspace-flex">
                <div id="fp-split">
                    <div id="chip-core"><div id="chip-core-bg"></div></div>
                    <div id="macro-side-panel"><div style="font-family:'Space Mono'; color:var(--text-secondary); font-size: 0.9rem; width: 100%; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 5px;">LIBRARY</div><div id="macro-lib" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; width: 100%;"></div></div>
                </div>
            </div>
            <div class="quiz-action-btns"><button class="btn" onclick="validateFP()">Run Signoff</button></div>
        </div>
    </section>

    <section id="router-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-network-wired"></i> NANO_ROUTER</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <p class="game-desc">Tap squares to route from <span style="color:var(--accent-3); font-weight:bold;">S</span> to <span style="color:var(--success); font-weight:bold;">T</span>. Tap the current head to undo.</p>
            <div class="workspace-flex"><div id="routing-grid" class="routing-grid"></div></div>
            <div class="quiz-action-btns"><button class="btn" style="background: transparent; color: var(--text-secondary); border-color: var(--text-secondary);" onclick="resetRouter()">Clear</button><button class="btn" style="background: rgba(0, 229, 255, 0.1);" onclick="initRouter()">New Net</button><button class="btn" onclick="validateRouter()">Verify</button></div>
        </div>
    </section>

    <section id="eco-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-stopwatch"></i> TIMING_CLOSURE</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <div class="stat-bar">
                <div class="stat-box" id="hud-setup">SETUP<br><span class="stat-val"><span id="val-setup">0</span>ps</span></div>
                <div class="stat-box" id="hud-hold">HOLD<br><span class="stat-val"><span id="val-hold">0</span>ps</span></div>
                <div class="stat-box" id="hud-area">AREA<br><span class="stat-val" id="val-area" style="color:var(--accent-1);">0</span></div>
                <div class="stat-box" id="hud-leak">LEAK<br><span class="stat-val" id="val-leak" style="color:var(--accent-2);">0</span></div>
            </div>
            <p class="game-desc">Target: Setup & Hold â‰¥ 0ps.<br>Tap gates to edit VT/Size. Tap wires to add/remove buffers.</p>
            
            <div class="workspace-flex" style="flex-direction: column;">
                <div class="eco-canvas" id="eco-schematic-view"></div>
                
                <div class="inspector" id="eco-inspector">
                    <div style="color: #fff; font-family: 'Space Mono'; font-weight: bold; margin-bottom: 12px; font-size: 1rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;" id="insp-title">Select cell</div>
                    <div class="insp-row">
                        <span class="insp-label">Library:</span>
                        <div class="insp-btn-group">
                            <button class="insp-btn" onclick="setVT('SVT')" id="btn-SVT">SVT</button>
                            <button class="insp-btn" onclick="setVT('LVT')" id="btn-LVT">LVT</button>
                            <button class="insp-btn" onclick="setVT('ULVT')" id="btn-ULVT">ULVT</button>
                            <button class="insp-btn" onclick="setVT('ELVT')" id="btn-ELVT">ELVT</button>
                        </div>
                    </div>
                    <div class="insp-row">
                        <span class="insp-label">Drive:</span>
                        <div class="insp-btn-group">
                            <button class="insp-btn" onclick="setSize(1)" id="btn-X1">X1</button>
                            <button class="insp-btn" onclick="setSize(2)" id="btn-X2">X2</button>
                            <button class="insp-btn" onclick="setSize(4)" id="btn-X4">X4</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="quiz-action-btns"><button class="btn" style="background: transparent; color: var(--text-secondary); border-color: var(--text-secondary);" onclick="initECO()">New Path</button><button class="btn" onclick="validateECO()">Signoff</button></div>
        </div>
    </section>

    <section id="cg-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-map-location-dot"></i> GLOBAL_ROUTING</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <div class="stat-bar">
                <div class="stat-box" id="cg-hud-len">WIRE_LENGTH<br><span class="stat-val" id="cg-val-len" style="color:var(--accent-1);">0</span><span style="color:var(--text-secondary); font-size:0.9rem;"> / <span id="cg-max-len">0</span></span></div>
            </div>
            <p class="game-desc">Connect S to T. Every cell has a <b>random capacity limit</b>. Do not overflow red cells or exceed the wirelength budget!</p>
            <div class="workspace-flex"><div id="cg-grid" class="routing-grid"></div></div>
            <div class="quiz-action-btns"><button class="btn" style="background: transparent; color: var(--text-secondary); border-color: var(--text-secondary);" onclick="resetCongestion()">Clear</button><button class="btn" style="background: rgba(0, 229, 255, 0.1);" onclick="initCongestion()">New Map</button><button class="btn" onclick="validateCongestion()">Signoff</button></div>
        </div>
    </section>

    <section id="si-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-satellite-dish"></i> CROSSTALK_SHIELD</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <div class="stat-bar" style="justify-content: center;"><div class="stat-box" id="hud-si-viols" style="font-size: 1rem; flex: none;">VIOLATIONS<br><span class="stat-val" id="val-si-viols" style="font-size: 1.6rem;">0</span></div></div>
            <p class="game-desc">Target: 0 Violations. <br><b>Drag and Drop</b> the tracks vertically to rearrange them. Shield the <span style="color:var(--success); font-weight:bold;">Victim nets</span> from the <span style="color:var(--danger); font-weight:bold;">Aggressors</span>!</p>
            
            <div class="si-workspace" id="si-workspace-view"></div>
            
            <div class="quiz-action-btns"><button class="btn" style="background: rgba(0, 240, 255, 0.1);" onclick="initSI()">New Channels</button><button class="btn" onclick="validateSI()">Signoff</button></div>
        </div>
    </section>

    <section id="skew-module" class="module-container">
        <div class="quiz-hud">
            <div class="hud-top"><div class="hud-title"><i class="fa-solid fa-clock-rotate-left"></i> TIME_BORROWING</div><button class="stop-btn" onclick="terminateSession()"><i class="fa-solid fa-power-off"></i> ABORT</button></div>
            <div class="stat-bar" style="justify-content: center;"><div class="stat-box" style="font-size: 1rem; flex: none; border-color: var(--accent-1); color: var(--accent-1);">TARGET PERIOD<br><span class="stat-val" style="color:var(--accent-1);">1000ps</span></div></div>
            <p class="game-desc">Target: All Slacks â‰¥ 0ps. Tap +/- to adjust FF clock arrival times. Borrow time from fast paths to fix slow paths.</p>
            <div class="workspace-flex"><div class="skew-pipe" id="skew-workspace-view"></div></div>
            <div class="quiz-action-btns"><button class="btn" style="background: transparent; color: var(--text-secondary); border-color: var(--text-secondary);" onclick="resetSkew()">Reset Clocks</button><button class="btn" style="background: rgba(0, 229, 255, 0.1);" onclick="initSkew()">New Logic</button><button class="btn" onclick="validateSkew()">Signoff</button></div>
        </div>
    </section>

</div> 

<footer class="app-footer" id="app-footer">
    Developed by <span>Pritesh Hirani</span> | &copy; 2026 <span>Hirani Tech</span>. All Rights Reserved.
</footer>

<div class="modal-overlay" id="missionModal">
    <div class="modal-box">
        <div class="mod-icon" id="modalIcon"></div>
        <h2 class="mod-title" id="modalHeading">MISSION_COMPLETE</h2>
        <div class="mod-stats">
            <div class="mod-stat"><span>STATUS</span><span id="statusValue" style="color: var(--success);">CLEARED</span></div>
            <div class="mod-stat" style="width: 1px; background: rgba(255,255,255,0.1);"></div>
            <div class="mod-stat"><span>INTEGRITY</span><span id="integrityValue" style="color: var(--accent-1);">100%</span></div>
        </div>
        <p class="mod-msg" id="modalMessage"></p>
        <div class="mod-btns">
            <button class="btn" onclick="restartCurrentGame()" style="background: transparent; border-color: var(--text-secondary); color: var(--text-secondary);">Play Again</button>
            <button class="btn" onclick="location.reload()">Command Center</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="terminateModal">
    <div class="modal-box" style="border-color: var(--danger); box-shadow: 0 20px 50px rgba(255,42,95,0.3);">
        <div class="mod-icon" style="color: var(--danger); text-shadow: 0 0 15px var(--danger);"><i class="fa-solid fa-radiation"></i></div>
        <h2 class="mod-title" style="color: var(--danger);">SYSTEM_OVERRIDE</h2>
        <p class="mod-msg">WARNING: Terminating the simulation will purge all temporary logic data. Proceed?</p>
        <div class="mod-btns">
            <button class="btn" onclick="closeTerminateModal()" style="background: transparent; border-color: var(--text-secondary); color: var(--text-secondary);">RESUME</button>
            <button class="btn" onclick="location.reload()" style="background: rgba(255,42,95,0.15); border-color: var(--danger); color: var(--danger);">TERMINATE</button>
        </div>
    </div>
</div>

<script src="script.js" defer></script>
<script>
    // --- Mobile Warning Logic ---
    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 800;
    }
    
    window.addEventListener('DOMContentLoaded', () => {
        if (isMobileDevice()) {
            document.getElementById('mobile-warning').style.display = 'flex';
        }
    });

    function closeWarning() {
        document.getElementById('mobile-warning').style.display = 'none';
        playTone(300, 'square', 0.1);
    }

    // --- Bootloader Logic ---
    window.addEventListener('load', () => {
        setTimeout(() => {
            document.getElementById('loader-overlay').classList.add('hidden');
            if(!isMobileDevice()) {
                playTone(600, 'sine', 0.1); 
                setTimeout(() => playTone(800, 'sine', 0.15), 100);
            }
        }, 1000);
    });

    // ================= GLOBAL AUDIO & UI LOGIC =================
    let activeGameModule = '';
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, type, duration, vol=0.1) { 
        if(audioCtx.state === 'suspended') audioCtx.resume(); 
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); 
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime); 
        gain.gain.setValueAtTime(vol, audioCtx.currentTime); 
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration); 
        osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration); 
    }
    const sfx = { 
        click: () => playTone(800, 'sine', 0.05, 0.02), 
        correct: () => { playTone(600, 'square', 0.1, 0.05); setTimeout(()=>playTone(800, 'square', 0.15, 0.05), 100); }, 
        wrong: () => playTone(150, 'sawtooth', 0.3, 0.1), 
        pickup: () => playTone(400, 'sine', 0.1, 0.05), 
        drop: () => playTone(200, 'sine', 0.1, 0.05), 
        drcError: () => playTone(200, 'square', 0.2, 0.1), 
        pass: () => { playTone(440, 'sine', 0.2); setTimeout(()=>playTone(554, 'sine', 0.2), 200); setTimeout(()=>playTone(659, 'sine', 0.4), 400); }, 
        fail: () => { playTone(200, 'sawtooth', 0.4); setTimeout(()=>playTone(150, 'sawtooth', 0.6), 400); } 
    };

    document.addEventListener('click', (e) => { 
        if(e.target.tagName === 'BUTTON' || e.target.closest('.btn') || e.target.classList.contains('insp-btn') || e.target.classList.contains('sk-btn')) sfx.click(); 
    });

    function enterImmersiveMode(moduleID) { 
        if(audioCtx.state === 'suspended') audioCtx.resume(); 
        
        document.getElementById('menu-view').style.display = 'none'; 
        
        if(window.innerWidth <= 850) {
            document.body.classList.add('game-active'); 
        }
        
        document.querySelectorAll('.module-container').forEach(m => {
            m.classList.remove('active-mod');
            m.style.display = 'none';
        });
        
        const targetMod = document.getElementById(moduleID);
        targetMod.classList.add('active-mod'); 
        targetMod.style.display = 'flex';
        window.scrollTo(0,0); 
    }

    function showMissionDebrief(isSuccess, integrity, message) { 
        const modal = document.getElementById('missionModal'); 
        const statusEl = document.getElementById('statusValue');
        statusEl.innerText = isSuccess ? "CLEARED" : "FAILED"; 
        statusEl.style.color = isSuccess ? "var(--success)" : "var(--danger)"; 
        document.getElementById('integrityValue').innerText = integrity; 
        document.getElementById('modalMessage').innerText = message; 
        const icon = document.getElementById('modalIcon');
        const box = modal.querySelector('.modal-box');
        if (isSuccess) { 
            icon.innerHTML = '<i class="fa-solid fa-circle-check"></i>'; 
            icon.style.color = "var(--success)"; icon.style.textShadow = "0 0 20px rgba(0,255,136,0.5)";
            box.style.borderColor = "var(--success)"; sfx.pass(); 
        } else { 
            icon.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i>'; 
            icon.style.color = "var(--danger)"; icon.style.textShadow = "0 0 20px rgba(255,42,95,0.5)";
            box.style.borderColor = "var(--danger)"; sfx.fail(); 
        } 
        modal.classList.add('active'); 
    }

    function restartCurrentGame() { 
        document.getElementById('missionModal').classList.remove('active'); 
        if(activeGameModule==='quiz') initQuiz(); else if(activeGameModule==='floorplan') initFloorplan(); else if(activeGameModule==='router') initRouter(); else if(activeGameModule==='eco') initECO(); else if(activeGameModule==='congestion') initCongestion(); else if(activeGameModule==='si') initSI(); else if(activeGameModule==='skew') initSkew(); 
    }
    function terminateSession() { document.getElementById('terminateModal').classList.add('active'); sfx.wrong(); }
    function closeTerminateModal() { document.getElementById('terminateModal').classList.remove('active'); }

    // ================= 1. QUIZ ENGINE =================
    const quizData = [ { q: "Which violation occurs if data arrives at the capture flop too late?", a: "Setup Violation", o: ["Setup Violation", "Hold Violation", "DRC Error", "LVS Error"] }, { q: "What is the primary purpose of Decaps in Physical Design?", a: "Mitigate IR Drop", o: ["Fix Hold", "Mitigate IR Drop", "Reduce Area", "Increase Clock Speed"] }, { q: "LVS in Physical Verification stands for?", a: "Layout vs Schematic", o: ["Logic vs Silicon", "Layout vs Schematic", "Local Via Shift", "Layer Voltage Sync"] }, { q: "Which metal layers are typical for Power/Ground Mesh?", a: "Upper Thick Metals", o: ["Lower Thin Metals", "Poly Layers", "Upper Thick Metals", "M1 only"] }, { q: "What is the main purpose of clock tree synthesis (CTS)?", a: "To distribute clock with minimum skew", o: ["To reduce power consumption", "To distribute clock with minimum skew", "To place standard cells", "To fix DRC errors"] },

{ q: "Which stage comes immediately after floorplanning in physical design flow?", a: "Placement", o: ["Routing", "Placement", "CTS", "Signoff"] },

{ q: "What does routing do in physical design?", a: "Connect placed cells with metal wires", o: ["Create logic gates", "Connect placed cells with metal wires", "Verify timing only", "Generate netlist"] },

{ q: "What is congestion in VLSI physical design?", a: "Too many wires competing for same routing area", o: ["Power leakage in cells", "Clock skew problem", "Too many wires competing for same routing area", "Missing vias"] },

{ q: "Which file contains physical layout information of the chip?", a: "GDSII", o: ["Verilog", "Liberty", "GDSII", "SDC"] },

{ q: "What is the main goal of placement optimization?", a: "Improve timing and reduce wirelength", o: ["Increase chip temperature", "Improve timing and reduce wirelength", "Add more logic gates", "Remove clock tree"] },

{ q: "What does DRC stand for?", a: "Design Rule Check", o: ["Design Routing Clock", "Data Rule Check", "Design Rule Check", "Dynamic Routing Control"] },

{ q: "What is hold violation caused by?", a: "Data arriving too early at capture flop", o: ["Data arriving too late", "Clock not generated", "Data arriving too early at capture flop", "Power supply drop"] },

{ q: "What is a standard cell in physical design?", a: "Pre-designed logic building block", o: ["Custom transistor layout", "Pre-designed logic building block", "Power grid structure", "Routing layer"] },

{ q: "Why are power rails used in chip layout?", a: "To supply VDD and GND to cells", o: ["To route clock signals", "To reduce wirelength", "To supply VDD and GND to cells", "To perform LVS"] } ];
    let qIndex=0, score=0, qTimer, qTimeLeft=30;
    function initQuiz() { activeGameModule='quiz'; enterImmersiveMode('quiz-module'); qIndex=0; score=0; loadQ(); }
    function loadQ() { qTimeLeft=30; document.getElementById('timer-val').innerText=qTimeLeft; document.getElementById('timer-bar').style.strokeDashoffset=0; clearInterval(qTimer); qTimer=setInterval(()=>{qTimeLeft--;document.getElementById('timer-val').innerText=qTimeLeft;document.getElementById('timer-bar').style.strokeDashoffset=163-(qTimeLeft/30)*163;if(qTimeLeft<=0){clearInterval(qTimer);checkA(null)}},1000); document.getElementById('question-text').innerText=quizData[qIndex].q; document.getElementById('quiz-progress').innerText=`Node: ${qIndex+1}/${quizData.length}`; const grid=document.getElementById('options-grid'); grid.innerHTML=''; [...quizData[qIndex].o].sort(()=>Math.random()-0.5).forEach(opt=>{const b=document.createElement('div');b.className='option-card';b.innerText=opt;b.onclick=()=>checkA(opt,b);grid.appendChild(b)}); document.getElementById('next-q').style.display='none'; }
    function checkA(opt, el) { clearInterval(qTimer); const correct=quizData[qIndex].a; if(opt===correct){score++;sfx.correct()}else{sfx.wrong()} document.querySelectorAll('.option-card').forEach(card=>{if(card.innerText===correct)card.classList.add('correct');card.style.pointerEvents='none'}); if(opt!==correct&&el)el.classList.add('wrong'); document.getElementById('next-q').style.display='block'; }
    function nextQuestion() { qIndex++; if(qIndex<quizData.length)loadQ(); else finishQuizEarly(); }
    function finishQuizEarly() { clearInterval(qTimer); const pct=Math.round((score/quizData.length)*100); showMissionDebrief(pct>=50, pct+"%", pct>=50?"Logic gates synchronized.":"Critical logic errors detected."); }

    // ================= 2. FLOORPLAN ENGINE =================
    let fpActiveM=null, fpOffset={x:0, y:0}, fpMacrosTotal = 0, macros = [];
    
    function initFloorplan() { 
        activeGameModule='floorplan'; enterImmersiveMode('floorplan-module'); 
        const lib = document.getElementById('macro-lib'); lib.innerHTML=''; 
        const core = document.getElementById('chip-core'); 
        
        // Wipe core except the background
        core.innerHTML = '<div id="chip-core-bg"></div>';
        document.getElementById('ov-count').innerText = "0"; 
        document.getElementById('hud-drc-fp').classList.remove('alert-txt');

        fpMacrosTotal = Math.floor(Math.random() * 4) + 3; 
        macros = [];
        
        for(let i=0; i<fpMacrosTotal; i++) {
            let isVertical = Math.random() > 0.5;
            let w_pct = isVertical ? (Math.random() * 8 + 8) : (Math.random() * 20 + 10); 
            let h_pct = isVertical ? (Math.random() * 20 + 10) : (Math.random() * 8 + 8); 
            
            let mObj = { id: i, top: 0, left: 0, w: w_pct, h: h_pct, fixed: false };
            
            // Create item in library sidebar
            let libEl = document.createElement('div');
            libEl.className = 'macro-library-item';
            libEl.innerText = "M" + i;
            
            // When library item is clicked
            libEl.addEventListener('pointerdown', (e) => {
                if(e.button !== 0 && e.pointerType === 'mouse') return;
                if(e.cancelable) e.preventDefault(); 
                
                // 1. Create the actual macro in the core
                let el = document.createElement('div');
                el.className = 'gui-macro';
                el.innerText = "M" + i;
                el.style.width = w_pct + '%';
                el.style.height = h_pct + '%';
                core.appendChild(el);
                
                mObj.el = el;
                macros.push(mObj);
                
                // 2. Remove the library placeholder
                libEl.remove();

                // 3. Start drag tracking immediately
                fpActiveM = mObj; 
                el.classList.add('dragging');
                sfx.pickup(); 
                
                const coreRect = core.getBoundingClientRect();
                let clientX = e.clientX || (e.touches && e.touches[0].clientX);
                let clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                let elW = (w_pct / 100) * coreRect.width;
                let elH = (h_pct / 100) * coreRect.height;
                
                // Calculate center teleportation
                let rawX = clientX - coreRect.left - (elW / 2);
                let rawY = clientY - coreRect.top - (elH / 2);
                
                // Clamp to borders
                rawX = Math.max(0, Math.min(rawX, coreRect.width - elW));
                rawY = Math.max(0, Math.min(rawY, coreRect.height - elH));

                mObj.left = (rawX / coreRect.width) * 100;
                mObj.top = (rawY / coreRect.height) * 100;

                el.style.left = mObj.left + '%';
                el.style.top = mObj.top + '%';
                
                // Keep mouse locked to center of macro for the rest of this drag
                fpOffset.x = elW / 2; 
                fpOffset.y = elH / 2; 

                // Add window listeners so drag doesn't break if you swipe fast
                window.addEventListener('pointermove', fpDoDrag, {passive: false}); 
                window.addEventListener('touchmove', fpDoDrag, {passive: false}); 
                window.addEventListener('pointerup', fpStopDrag); 
                window.addEventListener('touchend', fpStopDrag); 
                window.addEventListener('pointercancel', fpStopDrag); 

                // Double click to fix position
                el.addEventListener('dblclick', (ev) => {
                    mObj.fixed = !mObj.fixed;
                    if(mObj.fixed) { el.classList.add('fixed'); el.innerText = "ðŸ”’"; playTone(600, 'sine', 0.1); } 
                    else { el.classList.remove('fixed'); el.innerText = "M" + i; playTone(400, 'sine', 0.1); }
                });

                // Add drag listener to the core macro for future moves
                el.addEventListener('pointerdown', (ev) => {
                    if(ev.button !== 0 && ev.pointerType === 'mouse') return;
                    if(ev.cancelable) ev.preventDefault(); 
                    if(mObj.fixed) return;
                    
                    fpActiveM = mObj; 
                    el.classList.add('dragging');
                    sfx.pickup(); 
                    
                    let cX = ev.clientX || (ev.touches && ev.touches[0].clientX);
                    let cY = ev.clientY || (ev.touches && ev.touches[0].clientY);
                    
                    const r = el.getBoundingClientRect(); 
                    fpOffset.x = cX - r.left; 
                    fpOffset.y = cY - r.top; 

                    window.addEventListener('pointermove', fpDoDrag, {passive: false}); 
                    window.addEventListener('touchmove', fpDoDrag, {passive: false}); 
                    window.addEventListener('pointerup', fpStopDrag); 
                    window.addEventListener('touchend', fpStopDrag); 
                    window.addEventListener('pointercancel', fpStopDrag); 
                });

                fpCheckDRC();
            });
            
            lib.appendChild(libEl);
        }
    }
    
    function fpDoDrag(e) { 
        if(!fpActiveM) return; 
        if(e.cancelable) e.preventDefault(); 
        
        let clientX = e.clientX || (e.touches && e.touches[0].clientX);
        let clientY = e.clientY || (e.touches && e.touches[0].clientY);
        
        const coreRect = document.getElementById('chip-core').getBoundingClientRect(); 
        let x = clientX - coreRect.left - fpOffset.x; 
        let y = clientY - coreRect.top - fpOffset.y; 
        
        x = Math.max(0, Math.min(x, coreRect.width - fpActiveM.el.offsetWidth)); 
        y = Math.max(0, Math.min(y, coreRect.height - fpActiveM.el.offsetHeight)); 
        
        fpActiveM.left = (x / coreRect.width) * 100;
        fpActiveM.top = (y / coreRect.height) * 100;
        
        fpActiveM.el.style.left = fpActiveM.left + '%'; 
        fpActiveM.el.style.top = fpActiveM.top + '%'; 
        fpCheckDRC(); 
    }
    
    function fpStopDrag(e) { 
        if(!fpActiveM) return;
        fpActiveM.el.classList.remove('dragging');
        
        window.removeEventListener('pointermove', fpDoDrag); 
        window.removeEventListener('touchmove', fpDoDrag); 
        window.removeEventListener('pointerup', fpStopDrag); 
        window.removeEventListener('touchend', fpStopDrag); 
        window.removeEventListener('pointercancel', fpStopDrag); 
        
        fpActiveM = null; 
        let ov = parseInt(document.getElementById('ov-count').innerText); 
        if(ov > 0) sfx.drcError(); else sfx.drop(); 
    }
    
    function fpCheckDRC() { 
        const ms=document.querySelectorAll('#chip-core .gui-macro'); let ov=0; ms.forEach(m=>m.classList.remove('overlap')); 
        for(let i=0; i<ms.length; i++){
            for(let j=i+1; j<ms.length; j++){
                const r1=ms[i].getBoundingClientRect(), r2=ms[j].getBoundingClientRect(); 
                if(!(r1.right - 1 <= r2.left || r1.left + 1 >= r2.right || r1.bottom - 1 <= r2.top || r1.top + 1 >= r2.bottom)){ ms[i].classList.add('overlap'); ms[j].classList.add('overlap'); ov++; }
            }
        } 
        document.getElementById('ov-count').innerText=ov; 
        if(ov > 0) document.getElementById('hud-drc-fp').classList.add('alert-txt'); else document.getElementById('hud-drc-fp').classList.remove('alert-txt');
    }
    
    function validateFP() { 
        const ov=parseInt(document.getElementById('ov-count').innerText); const placed=document.querySelectorAll('#chip-core .gui-macro').length; 
        if(placed < fpMacrosTotal) showMissionDebrief(false,"0%","DRC ERROR: All macros must be placed in core."); else if(ov>0) showMissionDebrief(false,"40%","SIGNOFF FAILED: Violations detected."); else showMissionDebrief(true,"100%","SIGNOFF SUCCESSFUL: GDSII Generated."); 
    }

    // ================= 3. ROUTER ENGINE =================
    let rtStart=[0,0], rtEnd=[5,5], rtObs=[], rtPath=[], rtComp=false;
    function initRouter() { activeGameModule='router'; enterImmersiveMode('router-module'); let valid=false; while(!valid){rtStart=[Math.floor(Math.random()*6),Math.floor(Math.random()*6)]; rtEnd=[Math.floor(Math.random()*6),Math.floor(Math.random()*6)]; if(Math.abs(rtStart[0]-rtEnd[0])+Math.abs(rtStart[1]-rtEnd[1])<4)continue; let numObs=Math.floor(Math.random()*9)+6; rtObs=[]; for(let i=0;i<numObs;i++){let ox=Math.floor(Math.random()*6),oy=Math.floor(Math.random()*6); let key=`${ox},${oy}`; if((ox!==rtStart[0]||oy!==rtStart[1])&&(ox!==rtEnd[0]||oy!==rtEnd[1])&&!rtObs.includes(key))rtObs.push(key);} let q=[[rtStart[0],rtStart[1]]]; let vis=new Set([`${rtStart[0]},${rtStart[1]}`]); let ok=false; while(q.length>0){let [cx,cy]=q.shift(); if(cx===rtEnd[0]&&cy===rtEnd[1]){ok=true;break;} for(let [dx,dy] of [[0,1],[1,0],[0,-1],[-1,0]]){let nx=cx+dx,ny=cy+dy,key=`${nx},${ny}`; if(nx>=0&&nx<6&&ny>=0&&ny<6&&!vis.has(key)&&!rtObs.includes(key)){vis.add(key);q.push([nx,ny]);}}} if(ok)valid=true; } resetRouter(); }
    function resetRouter() { rtPath=[{x:rtStart[0],y:rtStart[1]}]; rtComp=false; renderRouter(); }
    function renderRouter() { 
        const grid=document.getElementById('routing-grid'); grid.innerHTML=''; 
        for(let y=0;y<6;y++){
            for(let x=0;x<6;x++){
                const cell=document.createElement('div');cell.className='route-cell'; 
                if(x===rtStart[0]&&y===rtStart[1]){cell.classList.add('rt-start');cell.innerText='S'} 
                else if(x===rtEnd[0]&&y===rtEnd[1]){cell.classList.add('rt-end');cell.innerText='T'} 
                else if(rtObs.includes(`${x},${y}`))cell.classList.add('rt-obs'); 
                else cell.classList.add('rt-empty'); 
                const pi=rtPath.findIndex(p=>p.x===x&&p.y===y); 
                if(pi>0)cell.classList.add('rt-path'); 
                if(pi===rtPath.length-1&&rtPath.length>1)cell.classList.add('rt-head'); 
                cell.onclick = () => tapRouter(x,y); 
                grid.appendChild(cell);
            }
        } 
        document.getElementById('trace-len').innerText=rtPath.length-1; 
    }
    function tapRouter(x,y) { 
        if(rtComp)return; const ln=rtPath[rtPath.length-1]; 
        if(x===ln.x&&y===ln.y&&rtPath.length>1){rtPath.pop();sfx.drop();renderRouter();return;} 
        if(Math.abs(x-ln.x)+Math.abs(y-ln.y)===1){
            if(rtObs.includes(`${x},${y}`)||rtPath.some(p=>p.x===x&&p.y===y)){sfx.drcError();return} 
            rtPath.push({x,y}); sfx.pickup(); 
            if(x===rtEnd[0]&&y===rtEnd[1]){rtComp=true;sfx.correct()} 
            renderRouter(); 
        }else{sfx.wrong();} 
    }
    function validateRouter() { if(rtComp)showMissionDebrief(true,"100%","ROUTING SUCCESSFUL: Net connected."); else showMissionDebrief(false,"OPEN NET","SIGNOFF FAILED: Trace did not reach target."); }

    // ================= 4. ECO ENGINE =================
    const ecoVtData={'SVT':{s:1.0,l:1.0},'LVT':{s:1.3,l:2.5},'ULVT':{s:1.6,l:5.0},'ELVT':{s:2.0,l:10.0}};
    const ecoSzData={1:{s:1.0,a:1.0},2:{s:1.4,a:2.0},4:{s:1.8,a:4.0}};
    let ecoReqT=0, ecoReqH=0, ecoMaxA=0, ecoMaxL=0, ecoCells=[], ecoNets=[], ecoSelIdx=-1;
    function initECO() { activeGameModule='eco'; enterImmersiveMode('eco-module'); document.getElementById('eco-inspector').classList.remove('visible'); ecoSelIdx=-1; let numCells=Math.floor(Math.random()*2)+3; ecoCells=[]; ecoNets=[]; let initD=0, initA=0, initL=0; const vts = ['SVT', 'LVT', 'ULVT', 'ELVT']; const szs = [1, 2, 4]; for(let i=0;i<numCells;i++){let d=Math.floor(Math.random()*20)+20, p=Math.floor(Math.random()*3)+1, a=Math.floor(Math.random()*3)+1; let rVT = vts[Math.floor(Math.random()*vts.length)]; let rSz = szs[Math.floor(Math.random()*szs.length)]; ecoCells.push({id:"U"+(i+1),type:"NAND2",baseDelay:d,basePwr:p,baseArea:a,vt:rVT,size:rSz}); let ib=Math.floor(Math.random()*2); ecoNets.push({buf:ib}); initD+=(d/(ecoVtData[rVT].s*ecoSzData[rSz].s))+ib*15; initA+=(a*ecoSzData[rSz].a)+ib*2; initL+=(p*ecoSzData[rSz].a*ecoVtData[rVT].l)+ib*1;} ecoNets.push({buf:0}); ecoReqT=Math.floor(initD*0.8); ecoReqH=Math.floor(initD*0.4); ecoMaxA=Math.floor(initA*2.0); ecoMaxL=Math.floor(initL*2.5); updateECO(); }
    function updateECO() { let td=0, ta=0, tl=0; ecoCells.forEach(c=>{td+=c.baseDelay/(ecoVtData[c.vt].s*ecoSzData[c.size].s);tl+=c.basePwr*ecoSzData[c.size].a*ecoVtData[c.vt].l;ta+=c.baseArea*ecoSzData[c.size].a}); ecoNets.forEach(n=>{td+=n.buf*15;ta+=n.buf*2;tl+=n.buf*1}); td=Math.round(td); ta=Math.round(ta); tl=Math.round(tl); let ss=ecoReqT-td, hs=td-ecoReqH; document.getElementById('val-setup').innerText=ss; document.getElementById('val-hold').innerText=hs; document.getElementById('val-area').innerText=ta+"/"+ecoMaxA; document.getElementById('val-leak').innerText=tl+"/"+ecoMaxL; document.getElementById('hud-setup').className=ss<0?"stat-box alert-txt":"stat-box"; document.getElementById('hud-hold').className=hs<0?"stat-box alert-txt":"stat-box"; document.getElementById('hud-area').className=ta>ecoMaxA?"stat-box alert-txt":"stat-box"; document.getElementById('hud-leak').className=tl>ecoMaxL?"stat-box alert-txt":"stat-box"; renderECO(); }
    function renderECO() { const v=document.getElementById('eco-schematic-view'); v.innerHTML='<div class="eco-flop">FF1</div>'; for(let i=0;i<ecoCells.length;i++){let bh='';for(let b=0;b<ecoNets[i].buf;b++)bh+=`<div class="eco-buf" onclick="remECOBuf(event,${i})"></div>`; v.innerHTML+=`<div class="eco-wire-wrap"><div class="eco-wire" onclick="addECOBuf(${i})">${bh}</div></div>`; const c=ecoCells[i]; v.innerHTML+=`<div class="eco-gate ${i===ecoSelIdx?'active':''}" onclick="openECOInsp(${i})"><div class="gate-nm">${c.id}</div><div class="gate-sp"><span>X${c.size}</span><span class="spec-vt">${c.vt}</span></div></div>`;} let fbh='';for(let b=0;b<ecoNets[ecoCells.length].buf;b++)fbh+=`<div class="eco-buf" onclick="remECOBuf(event,${ecoCells.length})"></div>`; v.innerHTML+=`<div class="eco-wire-wrap"><div class="eco-wire" onclick="addECOBuf(${ecoCells.length})">${fbh}</div></div><div class="eco-flop">FF2</div>`; }
    function addECOBuf(i){ecoNets[i].buf++;sfx.pickup();updateECO()}
    function remECOBuf(e,i){e.stopPropagation();e.preventDefault();if(ecoNets[i].buf>0){ecoNets[i].buf--;sfx.drop();updateECO()}}
    function openECOInsp(i){
        ecoSelIdx=i; const c=ecoCells[i];
        document.getElementById('eco-inspector').classList.add('visible');
        document.getElementById('insp-title').innerText=`Edit Gate: ${c.id}`;
        sfx.pickup();
        ['SVT','LVT','ULVT','ELVT'].forEach(v => { let el = document.getElementById('btn-'+v); if(el) el.classList.remove('active'); });
        [1,2,4].forEach(s => { let el = document.getElementById('btn-X'+s); if(el) el.classList.remove('active'); });
        let vtBtn = document.getElementById('btn-'+c.vt); if(vtBtn) vtBtn.classList.add('active');
        let szBtn = document.getElementById('btn-X'+c.size); if(szBtn) szBtn.classList.add('active');
        renderECO();
    }
    function setVT(vt){if(ecoSelIdx>-1){ecoCells[ecoSelIdx].vt=vt;openECOInsp(ecoSelIdx);updateECO()}}
    function setSize(sz){if(ecoSelIdx>-1){ecoCells[ecoSelIdx].size=sz;openECOInsp(ecoSelIdx);updateECO()}}
    function validateECO() { let s=parseInt(document.getElementById('val-setup').innerText), h=parseInt(document.getElementById('val-hold').innerText), a=parseInt(document.getElementById('val-area').innerText.split('/')[0]), l=parseInt(document.getElementById('val-leak').innerText.split('/')[0]); if(a>ecoMaxA||l>ecoMaxL)showMissionDebrief(false,"FAIL","Budget exceeded."); else if(s<0||h<0)showMissionDebrief(false,"FAIL","Timing violation."); else showMissionDebrief(true,"MET","Timing closed safely."); }

    // ================= 5. CONGESTION ENGINE =================
    let cgMaxL=14, cgGridData=[], cgRouteData=[], cgComp=false;
    function initCongestion() { 
        activeGameModule='congestion'; enterImmersiveMode('cg-module'); 
        let valid=false; 
        while(!valid){
            cgGridData=[];
            for(let y=0;y<6;y++){
                let row=[];
                for(let x=0;x<6;x++){
                    let maxT=Math.floor(Math.random()*4)+3; 
                    let u=Math.floor(Math.random()*(maxT + 1)); 
                    if((x===0&&y===0)||(x===5&&y===5)){u=0;maxT=6;} 
                    row.push({u:u, m:maxT});
                }
                cgGridData.push(row);
            } 
            let q=[[0,0,0]];let vis=new Set(['0,0']);let ok=false;let sh=0;
            while(q.length>0){
                let [cx,cy,d]=q.shift();
                if(cx===5&&cy===5){ok=true;sh=d;break;}
                for(let [dx,dy] of [[0,1],[1,0],[0,-1],[-1,0]]){
                    let nx=cx+dx,ny=cy+dy,key=`${nx},${ny}`;
                    if(nx>=0&&nx<6&&ny>=0&&ny<6&&!vis.has(key)&&cgGridData[ny][nx].u < cgGridData[ny][nx].m){
                        vis.add(key);q.push([nx,ny,d+1]);
                    }
                }
            }
            if(ok){valid=true;cgMaxL=sh+4;}
        } 
        document.getElementById('cg-max-len').innerText=cgMaxL; resetCongestion(); 
    }
    function resetCongestion() { cgRouteData=[{x:0,y:0}]; cgComp=false; renderCG(); }
    function renderCG() { 
        const grid=document.getElementById('cg-grid'); grid.innerHTML=''; 
        let cLen=cgRouteData.length-1; document.getElementById('cg-val-len').innerText=cLen; 
        const lHud=document.getElementById('cg-hud-len'); 
        if(cLen>cgMaxL)lHud.classList.add('alert-txt'); else lHud.classList.remove('alert-txt'); 
        for(let y=0;y<6;y++){
            for(let x=0;x<6;x++){
                let cellD=cgGridData[y][x]; 
                let isR=cgRouteData.findIndex(p=>p.x===x&&p.y===y)>-1;
                let isH=(cgRouteData.length>1&&cgRouteData[cgRouteData.length-1].x===x&&cgRouteData[cgRouteData.length-1].y===y);
                let u=cellD.u+(isR?1:0);
                let cls='cg-cell';
                if(u===0)cls+=' cg-empty';else if(u<=cellD.m-2)cls+=' cg-safe';else if(u===cellD.m-1)cls+=' cg-warn';else if(u===cellD.m)cls+=' cg-full';else cls+=' cg-drc';
                if(isH)cls+=' cg-head';
                const c=document.createElement('div');c.className=cls;
                c.innerHTML=(x===0&&y===0?'<div class="cg-st">S</div>':'')+(x===5&&y===5?'<div class="cg-st target">T</div>':'')+(isR?'<div class="cg-wire-dot"></div>':'')+`<div class="cg-label">${u}/${cellD.m}</div>`;
                c.onclick = () => tapCG(x,y);
                grid.appendChild(c);
            }
        } 
    }
    function tapCG(x,y) { 
        if(cgComp)return; const ln=cgRouteData[cgRouteData.length-1]; 
        if(x===ln.x&&y===ln.y&&cgRouteData.length>1){cgRouteData.pop();sfx.drop();renderCG();return;} 
        if(Math.abs(x-ln.x)+Math.abs(y-ln.y)===1){
            if(cgRouteData.some(p=>p.x===x&&p.y===y)){sfx.wrong();return;} 
            cgRouteData.push({x,y}); 
            if((cgGridData[y][x].u+1)>cgGridData[y][x].m)sfx.drcError();else sfx.pickup(); 
            if(x===5&&y===5){cgComp=true;sfx.correct();} 
            renderCG(); 
        }else{sfx.wrong();} 
    }
    function validateCongestion() { 
        if(!cgComp){showMissionDebrief(false,"OPEN","Must reach Target.");return;} 
        let hasD=false;cgRouteData.forEach(p=>{if(cgGridData[p.y][p.x].u+1>cgGridData[p.y][p.x].m)hasD=true;}); 
        if(hasD)showMissionDebrief(false,"DRC FAIL",`GCell capacity limit exceeded.`); 
        else if(cgRouteData.length-1>cgMaxL)showMissionDebrief(false,"LEN FAIL",`Max length (${cgMaxL}) exceeded.`); 
        else showMissionDebrief(true,"CLEAN","Detour successful."); 
    }

    // ================= 6. SIGNAL INTEGRITY DRAG & DROP ENGINE =================
    let siNets=[], dragSiIdx=-1, siDragEl=null;
    
    function initSI() { 
        activeGameModule='si'; enterImmersiveMode('si-module'); dragSiIdx=-1; 
        let pool=[{n:'Aggressor',i:'fa-bolt',e:40,t:999,c:'var(--danger)'},{n:'Crit. Victim',i:'fa-crosshairs',e:5,t:20,c:'var(--success)'},{n:'VDD Shield',i:'fa-shield-halved',e:0,t:999,c:'var(--accent-1)'},{n:'Quiet Net',i:'fa-wave-square',e:10,t:999,c:'var(--text-secondary)'}]; 
        let valid = false;
        while(!valid){
            siNets=[]; for(let i=0;i<6;i++){if(i===0)siNets.push(pool[0]);else if(i===1)siNets.push(pool[1]);else siNets.push(pool[Math.floor(Math.random()*pool.length)]);}
            siNets = siNets.sort(()=>Math.random()-0.5);
            let s=false; const c=(arr)=>{let viol=0;for(let i=0;i<arr.length;i++){let n=0;if(i>0)n+=arr[i-1].e;if(i<arr.length-1)n+=arr[i+1].e;if(n>arr[i].t)viol++;}return viol===0;};
            for(let k=0;k<100;k++){if(c([...siNets].sort(()=>Math.random()-0.5))){s=true;break;}}
            if(s && !c(siNets)) valid = true;
        }
        renderSI(); 
    }
    
    function renderSI() { 
        const ws=document.getElementById('si-workspace-view'); ws.innerHTML=''; let viols=0; 
        siNets.forEach((net,i)=>{
            let ns=0;if(i>0)ns+=siNets[i-1].e;if(i<siNets.length-1)ns+=siNets[i+1].e;
            if(ns>net.t)viols++; 
            let isViol = ns>net.t;
            
            const tr = document.createElement('div');
            tr.className = 'si-track';
            tr.dataset.idx = i;
            
            tr.innerHTML = `
                <div class="si-net">
                    <div class="si-info">
                        <i class="fa-solid fa-grip-lines si-grip"></i>
                        <i class="fa-solid ${net.i} si-icon" style="color:${net.c};"></i>
                        <div class="si-text">
                            <span class="si-name" style="color:${net.c}">${net.n}</span>
                            <span class="si-emit">Emits: ${net.e}mV</span>
                        </div>
                    </div>
                    <div class="si-badge-wrap">
                        <span class="si-badge-lbl">Noise</span>
                        <div class="si-badge" style="color:${isViol?'var(--danger)':(net.n==='Crit. Victim'?'var(--success)':'#fff')}; border-color:${isViol?'var(--danger)':'transparent'}">${ns}mV</div>
                    </div>
                </div>
            `;
            
            const netEl = tr.querySelector('.si-net');
            
            netEl.addEventListener('pointerdown', (e) => {
                if(e.button !== 0 && e.pointerType === 'mouse') return;
                if(e.cancelable) e.preventDefault(); 
                
                dragSiIdx = i;
                siDragEl = netEl;
                
                let rect = netEl.getBoundingClientRect();
                let wsRect = ws.getBoundingClientRect();
                
                siDragEl.classList.add('dragging');
                siDragEl.style.top = (rect.top - wsRect.top) + 'px';
                
                window.addEventListener('pointermove', moveSIDrag, {passive: false});
                window.addEventListener('touchmove', moveSIDrag, {passive: false});
                window.addEventListener('pointerup', stopSIDrag);
                window.addEventListener('touchend', stopSIDrag);
                window.addEventListener('pointercancel', stopSIDrag);
                sfx.pickup();
            });
            
            ws.appendChild(tr);
        }); 
        
        document.getElementById('val-si-viols').innerText=viols; 
        const hud=document.getElementById('hud-si-viols'); 
        if(viols>0){hud.classList.add('alert-txt');}else{hud.classList.remove('alert-txt');} 
    }
    
    function moveSIDrag(e) {
        if(!siDragEl) return;
        if(e.cancelable) e.preventDefault(); 
        
        let clientY = e.clientY || (e.touches && e.touches[0].clientY);
        let wsRect = document.getElementById('si-workspace-view').getBoundingClientRect();
        let y = clientY - wsRect.top - 32; 
        
        if(y < -10) y = -10;
        if(y > wsRect.height - 40) y = wsRect.height - 40;
        
        siDragEl.style.top = y + 'px';
    }
    
    function stopSIDrag(e) {
        if(!siDragEl) return;
        
        window.removeEventListener('pointermove', moveSIDrag);
        window.removeEventListener('touchmove', moveSIDrag);
        window.removeEventListener('pointerup', stopSIDrag);
        window.removeEventListener('touchend', stopSIDrag);
        window.removeEventListener('pointercancel', stopSIDrag);
        
        let clientY = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);
        let wsRect = document.getElementById('si-workspace-view').getBoundingClientRect();
        let y = clientY - wsRect.top;
        
        let slotHeight = wsRect.height / 6;
        let targetSlot = Math.floor(y / slotHeight);
        if(targetSlot < 0) targetSlot = 0;
        if(targetSlot > 5) targetSlot = 5;
        
        if(targetSlot !== dragSiIdx && targetSlot >= 0) {
            let temp = siNets[dragSiIdx];
            siNets.splice(dragSiIdx, 1);
            siNets.splice(targetSlot, 0, temp);
            sfx.drop();
        } else {
            sfx.click();
        }
        
        siDragEl.classList.remove('dragging');
        siDragEl.style.top = '';
        siDragEl = null;
        dragSiIdx = -1;
        renderSI();
    }

    function validateSI() { let viols=parseInt(document.getElementById('val-si-viols').innerText); if(viols>0)showMissionDebrief(false,viols+" VIOLS","Crosstalk threshold exceeded."); else showMissionDebrief(true,"0 VIOLS","Critical nets shielded."); }

    // ================= 7. USEFUL SKEW ENGINE =================
    const SKEW_PERIOD = 1000;
    let skewLogics = [], skewClks = [];
    function initSkew() { activeGameModule='skew'; enterImmersiveMode('skew-module'); let v=false; while(!v){skewLogics=[Math.floor(Math.random()*5+8)*100,Math.floor(Math.random()*5+8)*100,Math.floor(Math.random()*5+6)*100]; let sum=skewLogics[0]+skewLogics[1]+skewLogics[2]; let hasV=skewLogics.some(d=>d>SKEW_PERIOD); if(sum<=2800&&hasV)v=true;} skewClks=[0,0,0,0]; renderSkew(); }
    function resetSkew() { skewClks=[0,0,0,0]; renderSkew(); }
    function adjClk(idx, delta) { let nc=skewClks[idx]+delta; if(nc>=-500&&nc<=500){skewClks[idx]=nc; if(delta>0)sfx.pickup();else sfx.drop(); renderSkew();}else sfx.wrong(); }
    function renderSkew() { const ws=document.getElementById('skew-workspace-view'); ws.innerHTML=''; let slacks=[]; for(let i=0;i<3;i++){let r=skewClks[i+1]+SKEW_PERIOD, a=skewClks[i]+skewLogics[i]; slacks.push(r-a);} for(let i=0;i<4;i++){ if(i===0||i===3){let t=i===0?"FF1 (Launch)":"FF4 (Capture)"; ws.innerHTML+=`<div class="skew-flop-box"><div class="skew-flop"><div class="sk-title">${t}</div><div class="sk-val">Clk: 0ps</div></div></div>`;} else {let ac=skewClks[i]!==0?'active':''; ws.innerHTML+=`<div class="skew-flop-box"><div class="skew-flop ${ac}"><div class="sk-title">FF${i+1}</div><div class="sk-val">Clk: <span style="font-weight:bold;color:#fff;font-size:1.1rem;">${skewClks[i]}ps</span></div><div class="sk-btns"><button class="sk-btn" onclick="adjClk(${i},-50)"><i class="fa-solid fa-minus"></i></button><button class="sk-btn" onclick="adjClk(${i},50)"><i class="fa-solid fa-plus"></i></button></div></div></div>`;} if(i<3){let sc=slacks[i]>=0?'good':'bad'; ws.innerHTML+=`<div class="skew-path-box"><div class="sk-logic"><i class="fa-solid fa-microchip" style="color:var(--accent-1);"></i><br><span>${skewLogics[i]}ps</span></div><div class="sk-slack ${sc}">Slack<br><span>${slacks[i]}ps</span></div></div>`;} } }
    function validateSkew() { let slacks=[]; for(let i=0;i<3;i++)slacks.push((skewClks[i+1]+SKEW_PERIOD)-(skewClks[i]+skewLogics[i])); let f=slacks.filter(s=>s<0).length; if(f>0)showMissionDebrief(false,f+" VIOLS","Negative slack detected."); else showMissionDebrief(true,"TIMING MET","Time borrowed successfully."); }

</script>
</body>
</html>


